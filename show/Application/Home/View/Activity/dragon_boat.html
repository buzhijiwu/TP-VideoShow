<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="shortcut icon" href="/Public/Public/Images/favicon.ico"/>
    <link href="__PUBLIC__/Home/Css/{:getLanguage()}/reset.css?time=20160608.css" rel="stylesheet" type="text/css" />
    <link  href="__PUBLIC__/Home/Css/{:getLanguage()}/common.css?time=20160608.css" rel="stylesheet" type="text/css">
    <link  href="__PUBLIC__/Home/Css/{:getLanguage()}/layout.css?time=20160608.css" rel="stylesheet" type="text/css">
    <link  href="__PUBLIC__/Home/Css/{:getLanguage()}/active.css?time=20160608.css" rel="stylesheet" type="text/css">
    <!--<link  href="__PUBLIC__/Home/Css/{:getLanguage()}/layout.less?time=20160608.less" rel="stylesheet" type="text/less">-->
    <!--<link  href="__PUBLIC__/Home/Css/{:getLanguage()}/active.less?time=20160608.less" rel="stylesheet" type="text/less">-->
    <!--<script src="__PUBLIC__/Home/Css/{:getLanguage()}/less-1.6.3.min.js"></script>-->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->

    <title>Cuộc thi nhận bánh chưng</title>

</head>
<body class="dragon-boat-body">
<!--公用头部-->
<include file="Public:header" />

<div class="common-wrap">
    <div class="width">
        <div class="dragon-boat-main">

            <div class="title"></div>

            <!--规则、榜单-->
            <div class="tab-btn-top">
                <button class="active">Bảng xếp hạng</button>
                <button>Quy định trò chơi</button>
            </div>

            <!--榜单-->
            <div class="tab-list dragon-list-wrap ">

                <div class="em-title">
                    <img src="/Public/Public/Images/Activity/dragonBoat/em-top.png">
                </div>

                <div class="tab-btn clear">
                    <p class="p1 active">Điểm tổng</p>
                    <p class="p2">Quà tặng</p>
                    <p class="p3">Bảng follow</p>
                </div>

                <!--总分数榜-->
                <div class="em-active-list">
                    <table class="list-main">
                        <thead>
                        <tr>
                            <th class="td1">Xếp hạng</th>
                            <th class="td2">Nick của idol</th>
                            <th class="td3">Số điểm</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="topEmcTotal" id="vo" key="k">
                            <tr>
                                <td class="td1 <eq name="k" value="1">top1</eq>">
                                <span <in name="k" value="1,2,3">class="top-color"</in>>{$k}</span>
                                </td>
                                <td class="td2">
                                    <a href="/{$vo.roomno}">
                                        <img src="{$vo.smallheadpic}">
                                        <span class="common-em em{$vo.emceelevel}"></span>
                                        <span class="name">{$vo.nickname}</span>
                                    </a>
                                </td>
                                <td class="td3">
                                    <span>{$vo.total}</span>
                                </td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                    <button class="loading-more">
                        Bấm để xem nhiều hơn
                    </button>
                </div>

                <!--粽子礼物数-->
                <div class="em-active-list dis-none">
                    <table class="list-main">
                        <thead>
                        <tr>
                            <th class="td1">Xếp hạng</th>
                            <th class="td2">Nick của idol</th>
                            <th class="td3">Số lượng nhận được</th>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                    <button class="loading-more">
                        Bấm để xem nhiều hơn
                    </button>
                </div>

                <!--关注数-->
                <div class="em-active-list dis-none">
                    <table class="list-main">
                        <thead>
                        <tr>
                            <th class="td1">Xếp hạng</th>
                            <th class="td2">Nick của idol</th>
                            <th class="td3">Lượt theo dõi</th>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>

                    </table>
                    <button class="loading-more">
                        Bấm để xem nhiều hơn
                    </button>
                </div>


                <div class="em-title">
                    <img src="/Public/Public/Images/Activity/dragonBoat/us-top.png">
                </div>

                <!--用户榜-->
                <div class="us-active-list">
                    <table class="list-main">
                        <thead>
                        <tr>
                            <th class="td1">Xếp hạng</th>
                            <th class="td2">Nick của idol</th>
                            <th class="td3">Số quà đã tặng</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="topUserSentGift" id="vo" key="k">
                            <tr>
                                <td class="td1 <eq name="k" value="1">top1</eq>">
                                <span <in name="k" value="1,2,3">class="top-color"</in>>{$k}</span>
                                </td>
                                <td class="td2">
                                    <a href="Userhomepage/index/userid/{$vo.userid}">
                                        <img src="{$vo.smallheadpic}">
                                        <span class="common-em us{$vo.userlevel}"></span>
                                        <span class="name">{$vo.nickname}</span>
                                    </a>
                                </td>
                                <td class="td3">
                                    <span>{$vo.total}</span>
                                </td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                    <button class="loading-more">
                        Bấm để xem nhiều hơn
                    </button>
                </div>
            </div>

            <!--规则-->
            <div class="tab-list dis-none">
                <div class="rule clear">
                    <img src="/Public/Public/Images/Activity/dragonBoat/rule.png">
                </div>
            </div>


        </div>
    </div>
</div>

<input name="userid" id="userid" type="hidden" value="{$userid}" />


<!--共用底部-->
<include file="Public:bottom" />

<!-- 共用登录-->
<include file="Public:login" />

<!--共用弹框-->
<include file="Public:alert" />

<!--共用js-->
<include file="Public:javascript" />

<script>
    $(function () {
        //规则和列表切换
        $(".dragon-boat-main .tab-btn-top").on("click","button", function () {
            $(this).addClass("active").siblings("button").removeClass("active");
            $(".dragon-boat-main .tab-list").eq($(this).index()).removeClass("dis-none")
                    .siblings(".tab-list").addClass("dis-none");
        });



        var url = [
            "{:U('Home/Activity/getTopEmcTotalList')}",//主播总榜
            "{:U('Home/Activity/LoadTopActivityGiftList')}",//主播劳动礼物榜
            "{:U('Home/Activity/LoadTopActivityNewFans')}"//新增粉丝榜
        ];


        var data ={};



        $(".tab-btn").on("click","p", function () {
            $(this).addClass("active").siblings("p").removeClass("active");
            var n = $(this).index();
            $(".loading-more").eq(n).show();
            $(".em-active-list").eq(n).removeClass("dis-none").siblings(".em-active-list").addClass("dis-none");
            loadTopHtml(n);
        });

        $(".loading-more").each(function(index){
            if($(".list-main tbody").eq(index).find("tr").length<10){
                $(".loading-more").eq(index).hide();
            }
            $(".loading-more").eq(index).on("click",function () {
                $(this).hide();
                if(index < 3){
                    loadEmMoreHtml(index);
                }else{
                    loadUsMoreHtml();
                }

            })
        });

        //加载总榜前十列表
        function loadTopHtml(n){
            data ={
                'limit_start' : 0,
                'limit' : 10
            };
            $(".list-main").eq(n).find("tbody").html("<img src=\"/Public/Public/Images/Face/Joway/running.gif\" class='loading'>");

            $.ajax({
                url: url[n],
                data: data,
                dataType: 'json',
                type: "post",
                async:true,
                success: function(res) {
                    $(".list-main").eq(n).find("tbody").html(buildEmTopList(res));
                    if(res.length<10){
                        $(".loading-more").eq(n).hide();
                    }
                },
                error: function(res) {
                    console.log(res);
                }
            });
        }
        function buildEmTopList (data){

            var html = "",topClass,topColor,dataType;

            for(var i = 0; i < data.length ; i++) {
                if (i == 0) {
                    topClass = "td1 top1"
                } else {
                    topClass = "td1"
                }
                if (i < 3) {
                    topColor = "top-color"
                } else {
                    topColor = ""
                }
                html +=
                        "<tr>" +
                        "<td class=\"" + topClass + "\">" +
                        "<span class=\"" + topColor + "\">"+(i+1)+"</span>" +
                        "</td>" +
                        "<td class=\"td2\">" +
                        "<a href=\"{:U('Home/"+data[i].roomno+"/')}\">" +
                        "<img src=\"" + data[i].smallheadpic + "\">" +
                        "<span class=\"common-em em" + data[i].emceelevel + "\"></span>" +
                        "<span class=\"name\">" + data[i].nickname + "</span>" +
                        "</a>" +
                        "</td>" +
                        "<td class=\"td3\">" +
                        "<span>" + data[i].total + "</span>" +
                        "</td>" +
                        "</tr>"
            }

            return html;
        }

        //加载前三十列表
        function loadEmMoreHtml(n){
            data ={
                'limit_start' : 10,
                'limit' : 20
            };
            $.ajax({
                url: url[n],
                data: data,
                dataType: 'json',
                type: "post",
                async:true,
                success: function(res) {
                    $(".list-main").eq(n).find("tbody").append(buildEmMoreList(res));
                },
                error: function(res) {
                    console.log(res);
                }
            });
        }
        function buildEmMoreList (data){
            var html = "";
            for(var i = 0; i < data.length ; i++) {
                html +=
                        "<tr>" +
                        "<td class=\"td1\">" +
                        "<span>"+(i+11)+"</span>" +
                        "</td>" +
                        "<td class=\"td2\">" +
                        "<a href=\"{:U('Home/"+data[i].roomno+"/')}\">" +
                        "<img src=\"" + data[i].smallheadpic + "\">" +
                        "<span class=\"common-em em" + data[i].emceelevel + "\"></span>" +
                        "<span class=\"name\">" + data[i].nickname + "</span>" +
                        "</a>" +
                        "</td>" +
                        "<td class=\"td3\">" +
                        "<span>" + data[i].total + "</span>" +
                        "</td>" +
                        "</tr>"
            }
            return html;
        }
        //加载用户前三十列表
        function loadUsMoreHtml(){
            data ={
                'limit_start' : 10,
                'limit' : 20
            };
            $.ajax({
                url: "{:U('Home/Activity/getTopUserSentGiftList')}",
                data: data,
                dataType: 'json',
                type: "post",
                async:true,
                success: function(res) {
                    $(".us-active-list").find("tbody").append(buildUsMoreList(res));
                },
                error: function(res) {
                    console.log(res);
                }
            });
        }
        function buildUsMoreList (data){
            var html = "";
            for(var i = 0; i < data.length ; i++) {
                html +=
                        "<tr>" +
                        "<td class=\"td1\">" +
                        "<span>"+(i+11)+"</span>" +
                        "</td>" +
                        "<td class=\"td2\">" +
                        "<a href=\"{:U('Userhomepage/index/userid/"+data[i].userid+"/')}\">"+
                        "<img src=\"" + data[i].smallheadpic + "\">" +
                        "<span class=\"common-us us" + data[i].userlevel + "\"></span>" +
                        "<span class=\"name\">" + data[i].nickname + "</span>" +
                        "</a>" +
                        "</td>" +
                        "<td class=\"td3\">" +
                        "<span>" + data[i].total + "</span>" +
                        "</td>" +
                        "</tr>"
            }
            return html;
        }
    })
</script>
</body>
</html>